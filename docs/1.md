# 自进化 Skill 编排系统设计方案

## 1. 目标

创建一个基于 Claude Code skill 热重载机制的**自进化 AI Agent 框架**，通过元编程实现 skill 的自动生成、扩展和图结构编排。

## 2. 核心架构

### 2.1 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    Meta Skill (核心控制层)                    │
│  - 解析用户需求                                               │
│  - 生成新 skill 代码                                          │
│  - 管理 skill 注册表                                          │
│  - 热重载触发                                                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Skill Registry (注册中心)                  │
│  - skills.json: 所有 skill 的元数据                           │
│  - 依赖图 (DAG)                                               │
│  - 版本管理                                                   │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
   ┌─────────┐           ┌─────────┐           ┌─────────┐
   │ Skill A │ ───────▶  │ Skill B │ ───────▶  │ Skill C │
   └─────────┘           └─────────┘           └─────────┘
        │                     │
        └──────────┬──────────┘
                   ▼
              ┌─────────┐
              │ Skill D │
              └─────────┘
```

### 2.2 核心组件

1.  **Meta Skill (核心控制层)**：系统的"大脑"，负责生成和管理其他 skills。
2.  **Skill Registry (注册中心)**：系统的"记忆"，维护所有 skill 的元数据和依赖关系。
3.  **Skills (执行层)**：具体的业务逻辑单元，形成 DAG (有向无环图) 结构。

## 3. 文件结构

```
skill2/
├── _meta/                      # 元 Skill 层
│   ├── genesis.md              # 创世 skill - 生成其他 skill
│   ├── orchestrator.md         # 编排器 - 管理 skill 执行流
│   └── registry.md             # 注册表管理
│
├── _core/                      # 核心基础设施
│   ├── skill-template.md       # skill 模板
│   └── communication.md        # skill 间通信协议
│
├── _generated/                 # 自动生成的 skills (热重载目录)
│   ├── skill-001-data-fetch.md
│   ├── skill-002-transform.md
│   └── ...
│
├── skills.json                 # Skill 注册表 (DAG 定义)
└── context/                    # 共享上下文
    └── state.json              # 运行时状态
```

## 4. Skill 规范

每个 skill 文件头部必须包含元数据注释（YAML frontmatter）：

```yaml
---
id: skill-001
name: data-fetch
version: 1.0.0
description: 从 API 获取数据
directory: _generated/
upstream:
  - skill-000-init
downstream:
  - skill-002-transform
  - skill-003-validate
inputs:
  - url: string
  - headers: object?
outputs:
  - data: object
  - status: number
created_by: genesis
created_at: 2026-01-14
---
```

## 5. 核心组件详解

### 5.1 Genesis Skill (创世技能)

负责根据用户需求生成新的 skill。

- **指令**: `/genesis "需求描述"`
- **流程**:
  1.  分析需求
  2.  生成符合规范的 skill 文件
  3.  更新 `skills.json` 注册表
  4.  热重载自动生效

### 5.2 Orchestrator Skill (编排器)

管理 skill 执行流程。

- **指令**: `/orchestrate task="任务描述"`
- **流程**:
  1.  解析任务需求
  2.  遍历 `skills.json` 找到相关 skills
  3.  按 DAG 拓扑排序执行
  4.  传递上下文状态

### 5.3 通信协议

Skills 通过 `context/state.json` 共享状态：

```json
{
  "execution_id": "exec-001",
  "current_skill": "skill-002",
  "pipeline": ["skill-001", "skill-002", "skill-003"],
  "data": {
    "skill-001": { "output": {...} },
    "skill-002": { "status": "running" }
  }
}
```

## 6. 使用指南

### 6.1 生成新 Skill

```bash
/genesis "创建一个从 API 获取数据的 skill"
```

### 6.2 查看所有 Skills

```bash
/registry action=list
```

### 6.3 执行任务

```bash
/orchestrate task="处理数据"
```

## 7. 实施路线图

1.  **基础设施**: 创建目录结构，编写模板和注册表格式。
2.  **核心 Skills**: 实现 Genesis, Registry, Orchestrator。
3.  **通信层**: 实现状态管理和消息传递。
4.  **自进化**: 实现 Genesis 自我改进和 Skill 版本管理。
